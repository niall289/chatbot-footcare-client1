<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FootCare Clinic Chatbot - Interactive Demo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <style>
        :root {
            --primary: #0e8a7d;
            --primary-light: #10a193;
            --primary-dark: #087267;
            --background: #f9fafb;
            --card-bg: #ffffff;
            --bot-message-bg: #e8f5f4;
            --user-message-bg: #f1f5f9;
            --severity-high: #e53e3e;
            --severity-medium: #dd6b20;
            --severity-low: #38a169;
        }
        
        .chat-container {
            height: 500px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .bot-message {
            align-self: flex-start;
            background-color: var(--bot-message-bg);
            border-radius: 18px 18px 18px 0;
            max-width: 80%;
            margin-bottom: 12px;
            padding: 12px 16px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .bot-message::before {
            content: "";
            position: absolute;
            left: -6px;
            bottom: 0;
            width: 20px;
            height: 20px;
            background-color: var(--bot-message-bg);
            clip-path: polygon(0 0, 100% 100%, 100% 0);
            transform: rotate(90deg);
            border-radius: 0 0 0 4px;
        }
        
        .user-message {
            align-self: flex-end;
            background-color: var(--user-message-bg);
            border-radius: 18px 18px 0 18px;
            max-width: 80%;
            margin-bottom: 12px;
            padding: 12px 16px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .user-message::after {
            content: "";
            position: absolute;
            right: -6px;
            bottom: 0;
            width: 20px;
            height: 20px;
            background-color: var(--user-message-bg);
            clip-path: polygon(0 0, 0 100%, 100% 100%);
            transform: rotate(90deg);
            border-radius: 4px 0 0 0;
        }
        
        .nurse-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .severity-high {
            color: var(--severity-high);
            font-weight: 600;
        }
        
        .severity-medium {
            color: var(--severity-medium);
            font-weight: 600;
        }
        
        .severity-low {
            color: var(--severity-low);
            font-weight: 600;
        }
        
        .logo {
            height: 60px;
        }
        
        body {
            background-color: var(--background);
        }
        
        .typing-indicator {
            display: inline-block;
        }
        
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: var(--primary);
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite both;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0% { opacity: 0.3; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-5px); }
            100% { opacity: 0.3; transform: translateY(0); }
        }
        
        .hidden {
            display: none;
        }
        
        #fileUploadContainer {
            display: none;
        }
        
        .step-tracker {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 20%;
        }
        
        .step-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            color: #64748b;
            border: 2px solid #e2e8f0;
        }
        
        .step-icon.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .step-icon.completed {
            background-color: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }
        
        .step-label {
            font-size: 12px;
            color: #64748b;
            text-align: center;
        }
        
        .step-label.active {
            color: var(--primary);
            font-weight: 600;
        }
        
        .step-label.completed {
            color: var(--primary-light);
        }
        
        .option-button {
            background-color: #f1f5f9;
            border: 1px solid #e2e8f0;
            padding: 10px 16px;
            border-radius: 8px;
            text-align: left;
            transition: all 0.2s;
            margin-bottom: 8px;
            cursor: pointer;
        }
        
        .option-button:hover {
            background-color: #e8f5f4;
            border-color: var(--primary-light);
        }
        
        .textarea-field {
            width: 100%;
            min-height: 100px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            resize: vertical;
        }
        
        .whatsapp-button {
            background-color: #25D366;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            font-weight: 600;
            margin-top: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .whatsapp-button svg {
            margin-right: 8px;
        }
        
        .analysis-card {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="flex justify-between items-center mb-6">
            <div class="flex items-center">
                <img src="images/footcare-logo.png" alt="FootCare Clinic Logo" class="logo mr-3">
                <h1 class="text-2xl font-bold" style="color: var(--primary);">FootCare Clinic Virtual Assistant</h1>
            </div>
            <div class="text-sm text-gray-500">Interactive Demo</div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="mb-4">
                <div class="flex items-center mb-4">
                    <img src="images/nurse-avatar.png" alt="Nurse Fiona" class="nurse-avatar mr-3">
                    <div>
                        <h2 class="font-bold" style="color: var(--primary);">Fiona</h2>
                        <p class="text-sm text-gray-600">FootCare Specialist</p>
                    </div>
                </div>
                
                <div class="step-tracker mb-6">
                    <div class="step">
                        <div id="step-info" class="step-icon active">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="step-label active">Information</span>
                    </div>
                    <div class="step">
                        <div id="step-assess" class="step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M7 2a1 1 0 00-.707 1.707L7 4.414v3.758a1 1 0 01-.293.707l-4 4C.817 14.769 2.156 18 4.828 18h10.343c2.673 0 4.012-3.231 2.122-5.121l-4-4A1 1 0 0113 8.172V4.414l.707-.707A1 1 0 0013 2H7zm2 6.172V4h2v4.172a3 3 0 00.879 2.12l1.027 1.028a4 4 0 00-2.171.102l-.47.156a4 4 0 01-2.53 0l-.563-.187a1.993 1.993 0 00-.114-.035l1.063-1.063A3 3 0 009 8.172z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="step-label">Assessment</span>
                    </div>
                    <div class="step">
                        <div id="step-analysis" class="step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="step-label">Analysis</span>
                    </div>
                    <div class="step">
                        <div id="step-recommend" class="step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="step-label">Recommendations</span>
                    </div>
                    <div class="step">
                        <div id="step-schedule" class="step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="step-label">Schedule</span>
                    </div>
                </div>
            </div>

            <div id="chatContainer" class="chat-container mb-4 p-2">
                <!-- Messages will be added here dynamically -->
            </div>

            <div id="optionsContainer" class="my-4 hidden">
                <!-- Options will be added here dynamically -->
            </div>

            <div id="textareaContainer" class="my-4 hidden">
                <textarea id="userTextarea" class="textarea-field" placeholder="Type your detailed response here..."></textarea>
                <button id="textareaSendButton" class="px-4 py-2 rounded text-white" style="background-color: var(--primary);">
                    Send
                </button>
            </div>

            <div id="fileUploadContainer" class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Upload a foot image for analysis</label>
                <div class="flex items-center justify-center w-full">
                    <label class="flex flex-col w-full h-32 border-2 border-dashed border-gray-300 hover:bg-gray-50 hover:border-gray-400 rounded-lg cursor-pointer items-center justify-center">
                        <div id="previewContainer" class="hidden flex items-center justify-center">
                            <img id="imagePreview" class="max-h-28 max-w-full" />
                        </div>
                        <div id="uploadPrompt" class="flex flex-col items-center justify-center pt-7">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <p class="pt-1 text-sm tracking-wider text-gray-600 group-hover:text-gray-800">
                                Select an image
                            </p>
                        </div>
                        <input id="fileUpload" type="file" accept="image/*" class="hidden" />
                    </label>
                </div>
            </div>

            <div id="inputContainer" class="flex items-center">
                <input id="userInput" type="text" placeholder="Type your message..." class="flex-grow p-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                <button id="sendButton" class="text-white p-3 rounded-r-lg hover:bg-teal-700" style="background-color: var(--primary);">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                    </svg>
                </button>
            </div>

            <div id="whatsappButtonContainer" class="mt-4 text-center hidden">
                <button id="whatsappButton" class="whatsapp-button">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z" />
                        <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z" />
                    </svg>
                    Continue in WhatsApp
                </button>
            </div>
        </div>

        <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4" style="color: var(--primary);">About This Demo</h2>
            <p class="mb-4">This is an interactive demonstration of the FootCare Clinic Chatbot. You can:</p>
            <ul class="list-disc pl-6 mb-4">
                <li class="mb-2">Chat with our virtual assistant Fiona</li>
                <li class="mb-2">Upload an image for demonstration of our AI-powered foot analysis</li>
                <li class="mb-2">Experience the entire patient journey with our step tracker</li>
                <li class="mb-2">See recommendations based on your inputs</li>
            </ul>
            <p class="text-sm text-gray-500 italic">Note: This demo simulates the AI analysis for demonstration purposes. The full version uses OpenAI's advanced image processing technology.</p>
        </div>

        <footer class="mt-8 text-center text-gray-500 text-sm">
            <p>© 2025 FootCare Clinic - All Rights Reserved</p>
            <p class="mt-2">This is a demonstration preview only.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Chat functionality
            const chatContainer = document.getElementById('chatContainer');
            const userInput = document.getElementById('userInput');
            const sendButton = document.getElementById('sendButton');
            const optionsContainer = document.getElementById('optionsContainer');
            const fileUploadContainer = document.getElementById('fileUploadContainer');
            const fileUpload = document.getElementById('fileUpload');
            const imagePreview = document.getElementById('imagePreview');
            const previewContainer = document.getElementById('previewContainer');
            const uploadPrompt = document.getElementById('uploadPrompt');
            const textareaContainer = document.getElementById('textareaContainer');
            const userTextarea = document.getElementById('userTextarea');
            const textareaSendButton = document.getElementById('textareaSendButton');
            const whatsappButtonContainer = document.getElementById('whatsappButtonContainer');
            const whatsappButton = document.getElementById('whatsappButton');
            
            // Step tracker elements
            const stepInfo = document.getElementById('step-info');
            const stepAssess = document.getElementById('step-assess');
            const stepAnalysis = document.getElementById('step-analysis');
            const stepRecommend = document.getElementById('step-recommend');
            const stepSchedule = document.getElementById('step-schedule');
            
            let currentStep = 'welcome';
            let userData = {
                name: '',
                phone: '',
                email: '',
                preferredClinic: '',
                issueCategory: '',
                issueSpecifics: '',
                painDuration: '',
                painSeverity: '',
                additionalInfo: '',
                symptomDescription: '',
                previousTreatment: ''
            };
            
            // Chat flow definition - simplified version of the actual app's flow
            const chatFlow = {
                welcome: {
                    message: "👋 Hello! I'm Fiona, your FootCare Clinic virtual assistant. I'll help gather some information about your foot concerns and connect you with our specialists. Before we begin, I'll need to collect some basic information. Rest assured, your data is kept private and secure.",
                    next: "name"
                },
                name: {
                    message: "What's your name?",
                    input: "text",
                    next: "phone"
                },
                phone: {
                    message: "Great! Now, could you please provide your phone number?",
                    input: "tel",
                    next: "email"
                },
                email: {
                    message: "Thank you! Please share your email address:",
                    input: "email",
                    next: "preferred_clinic"
                },
                preferred_clinic: {
                    message: "Which of our locations would you prefer to visit?",
                    options: [
                        { text: "Donnycarney", value: "donnycarney" },
                        { text: "Palmerstown", value: "palmerstown" },
                        { text: "Baldoyle", value: "baldoyle" },
                        { text: "Not sure yet", value: "undecided" }
                    ],
                    next: "upload_image_prompt"
                },
                upload_image_prompt: {
                    message: "Would you like to upload a photo of your foot concern? This can help us provide a more accurate assessment.",
                    options: [
                        { text: "Yes, I'll upload an image", value: "yes" },
                        { text: "No, I prefer not to", value: "no" }
                    ],
                    next: (value) => {
                        if (value === "yes") return "image_upload_instructions";
                        return "issue_category";
                    }
                },
                image_upload_instructions: {
                    message: "Great! Please upload a clear photo of your foot concern. The image should be well-lit and show the affected area clearly. For privacy, avoid including any identifiable features or personal information in the photo.",
                    imageUpload: true,
                    next: "image_analysis_results"
                },
                image_analysis_results: {
                    message: "Thank you for sharing your image. Our AI system has analyzed it, and here are the preliminary findings:",
                    analysisResults: true,
                    next: "issue_category"
                },
                issue_category: {
                    message: "What type of foot concern brings you to our clinic today?",
                    options: [
                        { text: "Pain or discomfort", value: "pain" },
                        { text: "Skin issues", value: "skin" },
                        { text: "Nail problems", value: "nail" },
                        { text: "Structural concerns", value: "structural" },
                        { text: "Other concern", value: "other" }
                    ],
                    next: (value) => {
                        updateStepTracker('assess');
                        if (value === "pain") return "pain_specifics";
                        if (value === "skin") return "skin_specifics";
                        if (value === "nail") return "nail_specifics";
                        if (value === "structural") return "structural_specifics";
                        return "other_specifics";
                    }
                },
                pain_specifics: {
                    message: "Where are you experiencing foot pain?",
                    options: [
                        { text: "Heel", value: "heel" },
                        { text: "Arch", value: "arch" },
                        { text: "Ball of foot", value: "ball" },
                        { text: "Toes", value: "toes" },
                        { text: "Ankle", value: "ankle" },
                        { text: "Entire foot", value: "entire" }
                    ],
                    next: "pain_duration"
                },
                pain_duration: {
                    message: "How long have you been experiencing this pain?",
                    options: [
                        { text: "Less than a week", value: "acute" },
                        { text: "1-4 weeks", value: "subacute" },
                        { text: "1-3 months", value: "chronic_recent" },
                        { text: "More than 3 months", value: "chronic_long" }
                    ],
                    next: "pain_severity"
                },
                pain_severity: {
                    message: "On a scale from 1-10, how would you rate your pain?",
                    options: [
                        { text: "1-3 (Mild)", value: "mild" },
                        { text: "4-6 (Moderate)", value: "moderate" },
                        { text: "7-10 (Severe)", value: "severe" }
                    ],
                    next: "additional_info"
                },
                skin_specifics: {
                    message: "What skin issue are you experiencing?",
                    options: [
                        { text: "Dry/cracked skin", value: "dry" },
                        { text: "Calluses/corns", value: "callus" },
                        { text: "Warts", value: "warts" },
                        { text: "Rash/itching", value: "rash" },
                        { text: "Athlete's foot", value: "athletes_foot" },
                        { text: "Other skin issue", value: "other_skin" }
                    ],
                    next: "additional_info"
                },
                nail_specifics: {
                    message: "What nail problem are you experiencing?",
                    options: [
                        { text: "Ingrown toenail", value: "ingrown" },
                        { text: "Fungal infection", value: "fungal" },
                        { text: "Thickened nails", value: "thick" },
                        { text: "Discolored nails", value: "discolored" },
                        { text: "Other nail issue", value: "other_nail" }
                    ],
                    next: "additional_info"
                },
                structural_specifics: {
                    message: "What structural concern do you have?",
                    options: [
                        { text: "Bunions", value: "bunions" },
                        { text: "Hammertoes", value: "hammertoes" },
                        { text: "Flat feet", value: "flat_feet" },
                        { text: "High arches", value: "high_arches" },
                        { text: "Other structural issue", value: "other_structural" }
                    ],
                    next: "additional_info"
                },
                other_specifics: {
                    message: "Please briefly describe your foot concern:",
                    textarea: true,
                    next: "additional_info"
                },
                additional_info: {
                    message: "Is there anything else you'd like to share about your condition?",
                    textarea: true,
                    optional: true,
                    next: "symptom_description_prompt"
                },
                symptom_description_prompt: {
                    message: "Would you like to describe your symptoms in your own words? This will help our specialists prepare for your consultation.",
                    options: [
                        { text: "Yes, I'll describe my symptoms", value: "yes" },
                        { text: "No, continue to next step", value: "no" }
                    ],
                    next: (value) => {
                        updateStepTracker('analysis');
                        if (value === "yes") return "symptom_description";
                        return "previous_treatment";
                    }
                },
                symptom_description: {
                    message: "Please describe your symptoms in detail. Include when they started, any triggers, and how they affect your daily life:",
                    textarea: true,
                    next: "analyzing_symptoms"
                },
                analyzing_symptoms: {
                    message: "Thank you for describing your symptoms. I'll pass this information to our specialists...",
                    next: "symptom_analysis_handoff",
                    delay: 2000
                },
                symptom_analysis_handoff: {
                    message: "Our foot care specialists will review your symptom description during your appointment to provide a thorough assessment. This information helps us prepare for your visit.",
                    next: "previous_treatment",
                    delay: 2000
                },
                previous_treatment: {
                    message: "Have you previously received treatment for this condition?",
                    options: [
                        { text: "Yes", value: "yes" },
                        { text: "No", value: "no" }
                    ],
                    next: "prepare_transfer"
                },
                prepare_transfer: {
                    message: "Thank you for providing this information. Based on what you've shared, I'd like to connect you with our specialist for a more detailed consultation.",
                    next: "transfer_whatsapp",
                    delay: 2000
                },
                transfer_whatsapp: {
                    message: "I can transfer you to our clinic's WhatsApp for a direct conversation with our foot care specialist. Would you like to continue there?",
                    options: [
                        { text: "Yes, transfer to WhatsApp", value: "transfer" },
                        { text: "No, I'll call the clinic", value: "call" }
                    ],
                    next: (value) => {
                        updateStepTracker('recommend');
                        if (value === "transfer") return "whatsapp_handoff";
                        return "provide_phone";
                    }
                },
                whatsapp_handoff: {
                    message: "Great! Click the WhatsApp button below to continue your conversation with our specialist. Your information will be transferred securely.",
                    showWhatsApp: true,
                    next: "end"
                },
                provide_phone: {
                    message: "You can reach our clinic at 01 851 4444 during our operating hours: Monday-Friday 9am-5pm. Thank you for contacting FootCare Clinic!",
                    next: "end"
                },
                end: {
                    message: "Is there anything else I can help you with today?",
                    options: [
                        { text: "No, that's all for now", value: "goodbye" },
                        { text: "Yes, I have another question", value: "restart" }
                    ],
                    next: (value) => {
                        updateStepTracker('schedule');
                        if (value === "restart") return "issue_category";
                        return "goodbye";
                    }
                },
                goodbye: {
                    message: "Thank you for contacting FootCare Clinic! We look forward to helping you feel better soon. Goodbye! 👋",
                    end: true
                }
            };
            
            // Add initial message
            setTimeout(() => {
                displayNextStep(currentStep);
            }, 500);
            
            // Send button click event
            sendButton.addEventListener('click', handleUserInput);
            
            // Enter key press event
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleUserInput();
                }
            });
            
            // Textarea send button
            textareaSendButton.addEventListener('click', function() {
                const text = userTextarea.value.trim();
                if (text) {
                    addUserMessage(text);
                    processUserText(text);
                    textareaContainer.classList.add('hidden');
                    userTextarea.value = '';
                }
            });
            
            // WhatsApp button
            whatsappButton.addEventListener('click', function() {
                window.open('https://wa.me/353851234567?text=Hello,%20I%20would%20like%20to%20continue%20my%20foot%20consultation', '_blank');
            });
            
            // File upload change event
            fileUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        previewContainer.classList.remove('hidden');
                        uploadPrompt.classList.add('hidden');
                        
                        // Process the image after a delay
                        setTimeout(() => {
                            addUserMessage("I've uploaded an image of my foot");
                            fileUploadContainer.style.display = 'none';
                            addBotTypingIndicator();
                            
                            // Show analysis after a delay
                            setTimeout(() => {
                                removeBotTypingIndicator();
                                addBotMessage("Thank you for uploading the image. Our AI system has analyzed it, and here are the preliminary findings:");
                                
                                // Add analysis results
                                const analysisHTML = `
                                    <div class="analysis-card">
                                        <h3 class="font-bold text-lg mb-2">Image Analysis</h3>
                                        <p class="mb-2"><span class="font-semibold">Condition:</span> Plantar Fasciitis</p>
                                        <p class="mb-2"><span class="font-semibold">Severity:</span> <span class="severity-medium">Moderate</span></p>
                                        <p class="font-semibold mb-1">Recommendations:</p>
                                        <ul class="list-disc pl-5 mb-3">
                                            <li>Rest and ice the affected area</li>
                                            <li>Perform gentle stretching exercises</li>
                                            <li>Consider wearing supportive footwear</li>
                                            <li>Schedule an appointment with our podiatrist</li>
                                        </ul>
                                        <p class="text-xs text-gray-500 italic">Disclaimer: This is a preliminary analysis only. A proper diagnosis can only be made by a healthcare professional during an in-person examination.</p>
                                    </div>
                                `;
                                addBotMessage(analysisHTML);
                                
                                updateStepTracker('analysis');
                                
                                // Move to the next step
                                setTimeout(() => {
                                    displayNextStep('issue_category');
                                }, 2000);
                            }, 3000);
                        }, 500);
                    };
                    reader.readAsDataURL(file);
                }
            });

            function handleUserInput() {
                const text = userInput.value.trim();
                if (text === '') return;
                
                // Add user message to chat
                addUserMessage(text);
                
                // Clear input field
                userInput.value = '';
                
                // Process user input
                processUserText(text);
            }
            
            function processUserText(text) {
                // Store user data based on current step
                storeUserData(currentStep, text);
                
                // Show typing indicator
                addBotTypingIndicator();
                
                // Process based on current step and determine next step
                setTimeout(() => {
                    removeBotTypingIndicator();
                    
                    const currentStepConfig = chatFlow[currentStep];
                    let nextStep;
                    
                    if (typeof currentStepConfig.next === 'function') {
                        nextStep = currentStepConfig.next(text);
                    } else {
                        nextStep = currentStepConfig.next;
                    }
                    
                    displayNextStep(nextStep);
                }, 1000 + Math.random() * 1000);
            }
            
            function storeUserData(step, value) {
                switch(step) {
                    case 'name':
                        userData.name = value;
                        break;
                    case 'phone':
                        userData.phone = value;
                        break;
                    case 'email':
                        userData.email = value;
                        break;
                    case 'preferred_clinic':
                        userData.preferredClinic = value;
                        break;
                    case 'issue_category':
                        userData.issueCategory = value;
                        break;
                    case 'pain_specifics':
                    case 'skin_specifics':
                    case 'nail_specifics':
                    case 'structural_specifics':
                    case 'other_specifics':
                        userData.issueSpecifics = value;
                        break;
                    case 'pain_duration':
                        userData.painDuration = value;
                        break;
                    case 'pain_severity':
                        userData.painSeverity = value;
                        break;
                    case 'additional_info':
                        userData.additionalInfo = value;
                        break;
                    case 'symptom_description':
                        userData.symptomDescription = value;
                        break;
                    case 'previous_treatment':
                        userData.previousTreatment = value;
                        break;
                }
            }
            
            function displayNextStep(step) {
                if (!chatFlow[step]) return;
                
                currentStep = step;
                const stepConfig = chatFlow[step];
                
                // Display the bot message for this step
                addBotMessage(stepConfig.message);
                
                // Handle any special UI components for this step
                hideAllInputComponents();
                
                if (stepConfig.options) {
                    showOptions(stepConfig.options);
                } else if (stepConfig.textarea) {
                    showTextarea();
                } else if (stepConfig.imageUpload) {
                    showImageUpload();
                } else if (stepConfig.showWhatsApp) {
                    showWhatsAppButton();
                } else if (!stepConfig.end) {
                    // Default to text input if no special components and not the end
                    showTextInput();
                }
                
                // Handle any delay before automatic next step
                if (stepConfig.delay && !stepConfig.options && !stepConfig.textarea && !stepConfig.imageUpload) {
                    setTimeout(() => {
                        let nextStep;
                        if (typeof stepConfig.next === 'function') {
                            nextStep = stepConfig.next('');
                        } else {
                            nextStep = stepConfig.next;
                        }
                        displayNextStep(nextStep);
                    }, stepConfig.delay);
                }
            }
            
            function hideAllInputComponents() {
                optionsContainer.classList.add('hidden');
                optionsContainer.innerHTML = '';
                textareaContainer.classList.add('hidden');
                fileUploadContainer.style.display = 'none';
                whatsappButtonContainer.classList.add('hidden');
                inputContainer.classList.remove('hidden');
            }
            
            function showOptions(options) {
                optionsContainer.innerHTML = '';
                optionsContainer.classList.remove('hidden');
                
                options.forEach(option => {
                    const button = document.createElement('button');
                    button.className = "option-button";
                    button.textContent = option.text;
                    button.dataset.value = option.value;
                    button.addEventListener('click', function() {
                        addUserMessage(option.text);
                        optionsContainer.classList.add('hidden');
                        processUserText(option.value);
                    });
                    
                    optionsContainer.appendChild(button);
                });
                
                inputContainer.classList.add('hidden');
            }
            
            function showTextarea() {
                textareaContainer.classList.remove('hidden');
                inputContainer.classList.add('hidden');
            }
            
            function showImageUpload() {
                fileUploadContainer.style.display = 'block';
                inputContainer.classList.add('hidden');
            }
            
            function showWhatsAppButton() {
                whatsappButtonContainer.classList.remove('hidden');
                inputContainer.classList.add('hidden');
            }
            
            function showTextInput() {
                inputContainer.classList.remove('hidden');
            }
            
            function addUserMessage(text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'user-message';
                messageDiv.innerHTML = `<p>${text}</p>`;
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            function addBotMessage(text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'bot-message';
                messageDiv.innerHTML = `<p>${text}</p>`;
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            function addBotTypingIndicator() {
                const indicatorDiv = document.createElement('div');
                indicatorDiv.className = 'bot-message typing-message';
                indicatorDiv.innerHTML = `
                    <div class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                `;
                chatContainer.appendChild(indicatorDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            function removeBotTypingIndicator() {
                const typingMessage = document.querySelector('.typing-message');
                if (typingMessage) {
                    typingMessage.remove();
                }
            }
            
            function updateStepTracker(step) {
                // Reset all steps
                stepInfo.className = 'step-icon';
                stepAssess.className = 'step-icon';
                stepAnalysis.className = 'step-icon';
                stepRecommend.className = 'step-icon';
                stepSchedule.className = 'step-icon';
                
                document.querySelectorAll('.step-label').forEach(el => {
                    el.className = 'step-label';
                });
                
                // Update steps based on current progress
                switch(step) {
                    case 'info':
                        stepInfo.classList.add('active');
                        document.querySelector('.step:nth-child(1) .step-label').classList.add('active');
                        break;
                    case 'assess':
                        stepInfo.classList.add('completed');
                        stepAssess.classList.add('active');
                        document.querySelector('.step:nth-child(1) .step-label').classList.add('completed');
                        document.querySelector('.step:nth-child(2) .step-label').classList.add('active');
                        break;
                    case 'analysis':
                        stepInfo.classList.add('completed');
                        stepAssess.classList.add('completed');
                        stepAnalysis.classList.add('active');
                        document.querySelector('.step:nth-child(1) .step-label').classList.add('completed');
                        document.querySelector('.step:nth-child(2) .step-label').classList.add('completed');
                        document.querySelector('.step:nth-child(3) .step-label').classList.add('active');
                        break;
                    case 'recommend':
                        stepInfo.classList.add('completed');
                        stepAssess.classList.add('completed');
                        stepAnalysis.classList.add('completed');
                        stepRecommend.classList.add('active');
                        document.querySelector('.step:nth-child(1) .step-label').classList.add('completed');
                        document.querySelector('.step:nth-child(2) .step-label').classList.add('completed');
                        document.querySelector('.step:nth-child(3) .step-label').classList.add('completed');
                        document.querySelector('.step:nth-child(4) .step-label').classList.add('active');
                        break;
                    case 'schedule':
                        stepInfo.classList.add('completed');
                        stepAssess.classList.add('completed');
                        stepAnalysis.classList.add('completed');
                        stepRecommend.classList.add('completed');
                        stepSchedule.classList.add('active');
                        document.querySelector('.step:nth-child(1) .step-label').classList.add('completed');
                        document.querySelector('.step:nth-child(2) .step-label').classList.add('completed');
                        document.querySelector('.step:nth-child(3) .step-label').classList.add('completed');
                        document.querySelector('.step:nth-child(4) .step-label').classList.add('completed');
                        document.querySelector('.step:nth-child(5) .step-label').classList.add('active');
                        break;
                }
            }
        });
    </script>
</body>
</html>